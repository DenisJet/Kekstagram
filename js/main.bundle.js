(()=>{var e={125:()=>{const e=["gif","jpg","jpeg","png"],t=document.querySelector("#upload-file"),r=document.querySelector(".img-upload__preview img"),c=document.querySelectorAll(".effects__preview");t.addEventListener("change",(()=>{const n=t.files[0],o=n.name.toLowerCase();if(e.some((e=>o.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{r.src=e.result,c.forEach((t=>{t.style.backgroundImage=`url(${e.result})`}))})),e.readAsDataURL(n)}}))}},t={};function r(c){var n=t[c];if(void 0!==n)return n.exports;var o=t[c]={exports:{}};return e[c](o,o.exports,r),o.exports}(()=>{"use strict";const e=e=>"Escape"===e.key||"Esc"===e.key,t=document.querySelector(".big-picture"),c=document.querySelector("body"),n=t.querySelector(".big-picture__cancel"),o=document.querySelector("#comment").content.querySelector(".social__comment"),s=t.querySelector(".social__comments"),l=t.querySelector(".comments-loader"),i=t.querySelector(".social__comment-count");let a=[],d=5;const u=e=>{d=e.length<5?e.length:d,a=e.slice(0,d),s.innerHTML="",i.textContent=`${a.length} из ${e.length} комментариев`;let t=document.createDocumentFragment();a.forEach((e=>{t.appendChild((e=>{const t=o.cloneNode(!0);return t.querySelector(".social__picture").src=e.avatar,t.querySelector(".social__picture").alt=e.name,t.querySelector(".social__text").textContent=e.message,t})(e))})),s.appendChild(t),e.length>5&&a.length<e.length?(l.classList.remove("hidden"),l.addEventListener("click",(()=>{u(e)}),{once:!0})):l.classList.add("hidden"),d+=5},m=()=>{t.classList.add("hidden"),c.classList.remove("modal-open"),s.innerHTML="",n.removeEventListener("click",m),document.removeEventListener("keydown",v),a=[],d=5},v=t=>{e(t)&&m()},y=document.querySelector(".pictures"),p=document.querySelector("#picture").content.querySelector(".picture"),_=e=>{const r=document.createDocumentFragment();e.forEach((e=>{r.appendChild((e=>{const r=p.cloneNode(!0);return r.querySelector(".picture__img").src=e.url,r.querySelector(".picture__comments").textContent=e.comments.length,r.querySelector(".picture__likes").textContent=e.likes,r.addEventListener("click",(r=>{r.preventDefault(),(e=>{d=5,a=[],c.classList.add("modal-open"),t.querySelector(".big-picture__img > img").src=e.url,t.querySelector(".likes-count").textContent=e.likes,u(e.comments.slice()),t.querySelector(".social__caption").textContent=e.description,document.addEventListener("keydown",v),n.addEventListener("click",m),t.classList.remove("hidden")})(e)})),r})(e))})),y.appendChild(r)},g=document.querySelector(".scale__control--value"),h=document.querySelector(".img-upload__preview > img"),S=document.querySelector(".effect-level__slider"),f=document.querySelector(".effect-level__value"),q=document.querySelector(".effect-level"),L=document.querySelector("#effect-none"),E=document.querySelector(".text__hashtags"),k=document.querySelector(".text__description"),b=()=>{let e=parseInt(g.value,10)-25;e<=25&&(e=25),g.value=`${e}%`,h.style.transform=`scale(${e/100})`},x=()=>{let e=parseInt(g.value,10)+25;e>=100&&(e=100),g.value=`${e}%`,h.style.transform=`scale(${e/100})`},w=e=>{h.className=`effects__preview--${e.target.value}`,S.noUiSlider.set(100),h.classList.contains("effects__preview--none")?q.style.visibility="hidden":q.style.visibility="visible"},C={none:()=>"",chrome:()=>`grayscale(${.01*parseInt(f.value,10)})`,sepia:()=>`sepia(${.01*parseInt(f.value,10)})`,marvin:()=>`invert(${f.value}%)`,phobos:()=>`blur(${3*parseInt(f.value,10)*.01}px)`,heat:()=>`brightness(${3*parseInt(f.value,10)*.01})`};window.noUiSlider.create(S,{range:{min:0,max:100},start:100,step:1,connect:"lower"}),S.noUiSlider.on("update",((e,t,r)=>{S.value=r[t],f.value=S.value;const c=h.className.replace("effects__preview--","");h.style.filter=c?C[c](f.value):""}));const $=document.querySelector("#success").content,V=document.querySelector("#error").content,I=document.querySelector("body"),D=e=>{document.querySelector(e).remove()},N=e=>{document.querySelector(".success__inner").contains(e.target)||(D(".success"),document.removeEventListener("click",N))},T=t=>{e(t)&&(D(".success"),document.removeEventListener("keydown",T))},j=()=>{let e=$.cloneNode(!0);e.querySelector(".success__button").addEventListener("click",(()=>{D(".success")})),document.addEventListener("click",N),document.addEventListener("keydown",T),I.appendChild(e)},z=e=>{document.querySelector(".success__inner").contains(e.target)||(D(".success"),document.removeEventListener("click",z))},A=t=>{e(t)&&(D(".error"),document.removeEventListener("keydown",A))},F=()=>{let e=V.cloneNode(!0);e.querySelector(".error__button").addEventListener("click",(()=>{D(".error")})),document.addEventListener("click",z),document.addEventListener("keydown",A),I.appendChild(e)},M=new RegExp("[^a-zа-яё0-9#]"),U=document.querySelector(".text__hashtags"),H=()=>{if(U.setCustomValidity(""),""===U.value)return;const e=U.value.toLowerCase().trim().split(/\s+/);e.length>5&&U.setCustomValidity("Нельзя указать больше 5 хэш-тегов"),e.forEach((t=>{"#"!==t[0]?U.setCustomValidity("Хэш-тег начинается с символа # (решётка)"):M.test(t)?U.setCustomValidity("Недопустимый символ"):"#"==t?U.setCustomValidity("Хеш-тег не может состоять только из одной решётки"):t.length>20?U.setCustomValidity("Максимальная длина одного хэш-тега 20 символов"):t.indexOf("#",1)>=1?U.setCustomValidity("Хэш-теги разделяются пробелами"):e.length>new Set(e).size&&U.setCustomValidity("Один и тот же хэш-тег не может быть использован дважды")})),U.reportValidity()},R=e=>{e.preventDefault(),ne(j,F,new FormData(e.target))},O=document.querySelector("#upload-file"),P=document.querySelector(".img-upload__overlay"),W=P.querySelector("#upload-cancel"),B=P.querySelector(".scale__control--smaller"),G=P.querySelector(".scale__control--bigger"),J=P.querySelector(".effects__list"),K=P.querySelector(".effect-level"),Q=P.querySelector(".text__hashtags"),X=P.querySelector(".text__description"),Y=document.querySelector("body"),Z=document.querySelector(".img-upload__form"),ee=t=>{e(t)&&Q!=document.activeElement&&X!=document.activeElement&&(t.preventDefault(),te())},te=()=>{P.classList.add("hidden"),Y.classList.remove("modal-open"),O.value="",B.removeEventListener("click",b),G.removeEventListener("click",x),J.removeEventListener("click",w),W.removeEventListener("click",te),document.removeEventListener("keydown",ee),Z.removeEventListener("submit",R),Q.removeEventListener("input",H)};O.addEventListener("change",(()=>{P.classList.remove("hidden"),Y.classList.add("modal-open"),g.value="100%",h.style.transform="scale(1)",h.className="",h.style.filter="",L.checked=!0,E.value="",k.value="",B.addEventListener("click",b),G.addEventListener("click",x),K.style.visibility="hidden",J.addEventListener("click",w),W.addEventListener("click",te),document.addEventListener("keydown",ee),Z.addEventListener("submit",R),Q.addEventListener("input",H)}));const re=document.querySelector(".img-filters");let ce=[];const ne=(e,t,r)=>{fetch("https://23.javascript.pages.academy/kekstagram",{method:"POST",body:r}).then((r=>{te(),r.ok?e():t()})).catch((()=>{te(),t()}))},oe=document.querySelector(".pictures"),se=document.querySelector("#filter-default"),le=document.querySelector("#filter-random"),ie=document.querySelector("#filter-discussed"),ae=()=>{oe.querySelectorAll(".picture").forEach((e=>{e.remove()}))},de=()=>{document.querySelector(".img-filters__button--active").classList.remove("img-filters__button--active")},ue=(e,t)=>{let r;return function(){clearTimeout(r),r=setTimeout(e,t)}};se.addEventListener("click",ue((()=>{ae(),de(),se.classList.add("img-filters__button--active"),_(ce)}),500)),le.addEventListener("click",ue((()=>{ae(),de(),le.classList.add("img-filters__button--active");const e=[];for(let c=0;e.length<10;++c){const c=(r=void 0,(t=ce)[(r=t.length-1,r<0||0>=r?-1:Math.floor(Math.random()*(r-0+1))+0)]);e.includes(c)||e.push(c)}var t,r;_(e)}),500)),ie.addEventListener("click",ue((()=>{ae(),de(),ie.classList.add("img-filters__button--active"),_(ce.slice().sort(((e,t)=>t.comments.length-e.comments.length)))}),500)),r(125),fetch("https://23.javascript.pages.academy/kekstagram/data").then((e=>e.json())).then((e=>{ce=e.slice(),_(e),re.classList.remove("img-filters--inactive")})).catch((()=>{(e=>{const t=document.createElement("div");t.style.zIndex=100,t.style.position="absolute",t.style.left=0,t.style.top=0,t.style.right=0,t.style.padding="10px 3px",t.style.margin="25vh 25vw",t.style.lineHeight="30px",t.style.fontSize="30px",t.style.textAlign="center",t.style.backgroundColor="red",t.textContent="Не удалось получить данные. Попробуйте ещё раз (перезагрузите страницу)!",document.body.append(t),setTimeout((()=>{t.remove()}),5e3)})()}))})()})();
//# sourceMappingURL=main.bundle.js.map